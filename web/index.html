<!DOCTYPE html>
<html lang="de" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X-iNet Dashboard v1.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.9.4/dist/full.css" rel="stylesheet" type="text/css" />
    <style>
        body { background: radial-gradient(circle at top left, #1a1c2c, #0f1016); min-height: 100vh; }
        .glass-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .neon-text { text-shadow: 0 0 10px rgba(34, 197, 94, 0.5); }
        .stat-value { font-family: 'JetBrains Mono', 'Courier New', monospace; letter-spacing: -1px; }
    </style>
</head>
<body class="p-4 md:p-8">

<div class="max-w-6xl mx-auto space-y-6">
    
    <header class="flex flex-col md:flex-row justify-between items-center gap-6 mb-10">
        <div>
            <h1 class="text-4xl font-black italic tracking-tighter text-white">X-iNET <span class="text-success neon-text">v1.1</span></h1>
            <p class="text-xs uppercase tracking-widest opacity-50">Multi-Format Filter Pipeline</p>
        </div>
        
        <div class="stats glass-card shadow-2xl">
            <div class="stat">
                <div class="stat-title text-xs uppercase">Domains</div>
                <div class="stat-value text-success text-2xl" id="stat-total">0</div>
                <div class="stat-desc text-[10px]">VERARBEITET</div>
            </div>
            <div class="stat border-x border-white/5">
                <div class="stat-title text-xs uppercase">Filter</div>
                <div class="stat-value text-info text-2xl" id="stat-filters">0</div>
                <div class="stat-desc text-[10px]">EINZIGARTIG</div>
            </div>
            <div class="stat">
                <div class="stat-title text-xs uppercase">Auswahl</div>
                <div class="stat-value text-warning text-2xl" id="stat-selected">0</div>
                <div class="stat-desc text-[10px]">AKTIV</div>
            </div>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        
        <aside class="lg:col-span-4 space-y-6">
            <div class="card glass-card p-6 rounded-3xl">
                <h3 class="text-xs font-bold uppercase mb-4 tracking-widest text-white/70">Quellen-Status (Live)</h3>
                <div id="sources-list" class="space-y-4">
                    <div class="flex items-center gap-3"><span class="loading loading-ring loading-xs"></span> Initialisiere...</div>
                </div>
            </div>

            <div class="card glass-card p-6 rounded-3xl">
                <h3 class="text-xs font-bold uppercase mb-4 tracking-widest text-white/70">1. Schutz-Level (Toggles)</h3>
                <div class="grid grid-cols-1 gap-4" id="cat-group"></div>
            </div>
        </aside>

        <main class="lg:col-span-8 space-y-6">
            <div class="card glass-card p-8 rounded-3xl">
                <h3 class="text-xs font-bold uppercase mb-6 tracking-widest text-white/70">2. Daten-Limiter & Whitelist</h3>
                <div class="space-y-8">
                    <div class="form-control">
                        <label class="label"><span class="label-text text-white/60">Anzahl der Domains: <span class="text-success font-bold" id="limit-val">10'000</span></span></label>
                        <input type="range" id="limit-range" min="1000" max="150000" step="1000" value="10000" class="range range-success range-xs">
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text text-white/60">Whitelist (Ausnahmen)</span></label>
                        <textarea id="whitelist-input" class="textarea textarea-bordered bg-black/20 h-24 font-mono text-sm border-white/10" placeholder="facebook.com&#10;instagram.com" oninput="saveAndRefresh()"></textarea>
                    </div>
                </div>
            </div>

            <div class="card glass-card p-8 rounded-3xl">
                <h3 class="text-xs font-bold uppercase mb-6 tracking-widest text-white/70">3. Ziel-System & Direkt-Link</h3>
                <div class="flex flex-col md:flex-row gap-4 items-end">
                    <div class="form-control w-full">
                        <select id="target-system" class="select select-bordered bg-black/40 w-full border-white/10" onchange="updateUI()">
                            <option value="hosts">Universal HOSTS [max. 1'000'000+]</option>
                            <option value="flint2" selected>GL.iNet GL-MT6000 (Flint 2) [max. 150'000]</option>
                            <option value="adguard">AdGuard Home [max. 200'000]</option>
                            <option value="pihole">Pi-hole DNS [max. 500'000]</option>
                            <option value="mikrotik">Mikrotik RouterOS [max. 20'000]</option>
                            <option value="json">JSON Data Feed [Rohdaten]</option>
                        </select>
                    </div>
                    <button class="btn btn-success px-8 shadow-lg shadow-success/20" onclick="downloadConfig()">Download</button>
                </div>
                
                <div class="mt-6 p-4 bg-black/40 border border-white/5 rounded-xl">
                    <div class="text-[10px] uppercase opacity-40 mb-2">Link fuer den Router [cite: 2026-01-20]:</div>
                    <a id="router-link" class="text-xs text-info font-mono break-all hover:underline" target="_blank" href="#">Wird geladen...</a>
                </div>
            </div>

            <div class="card glass-card p-8 rounded-3xl">
                <h3 class="text-xs font-bold uppercase mb-4 tracking-widest text-success">Vorschau (Preview)</h3>
                <div class="bg-black/60 p-4 rounded-xl font-mono text-[11px] leading-relaxed text-success/70 max-h-48 overflow-y-auto" id="preview-area">
                    Analysiere Datenstroeme...
                </div>
            </div>
        </main>
    </div>

    <footer class="text-center py-10 opacity-30 text-[10px] tracking-widest uppercase">
        X-iNET Pipeline &bull; v1.1 &bull; 2026
    </footer>
</div>

<script>
    const GITHUB_BASE = "https://raw.githubusercontent.com/albertuszerk/inetfilterlist/main/output/";
    let masterStats = null, exportData = [];
    const sys = {
        hosts: { f: "xinet_universal_hosts.txt", p: "0.0.0.0 " },
        flint2: { f: "xinet_flint2.hosts", p: "" },
        adguard: { f: "xinet_adguard.txt", p: "||", s: "^" },
        pihole: { f: "xinet_pihole.txt", p: "" },
        mikrotik: { f: "xinet_mikrotik.rsc", p: "/ip dns static add name=", s: " address=0.0.0.0" },
        json: { f: "xinet_data.json", raw: true }
    };
    const categories = ["violence", "sex", "vpn_proxy", "gambling", "ads_tracking", "social"];
    function fmt(num) { return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "'"); }

    async function init() {
        const group = document.getElementById('cat-group');
        group.innerHTML = categories.map(c => `
            <div class="flex justify-between items-center bg-white/5 p-3 rounded-xl border border-white/5">
                <span class="text-[11px] font-bold uppercase tracking-widest text-white/60">${c.replace('_', ' ')}</span>
                <input type="checkbox" checked value="${c}" class="toggle toggle-success toggle-sm" onchange="updateUI()">
            </div>
        `).join('');

        try {
            const savedWhitelist = localStorage.getItem('xinet_whitelist_storage');
            if (savedWhitelist) document.getElementById('whitelist-input').value = savedWhitelist;
            const sRes = await fetch('../output/status.json'), dRes = await fetch('../output/xinet_data.json');
            masterStats = await sRes.json(); exportData = await dRes.json();
            renderStats(); updateUI();
        } catch (e) { document.getElementById('sources-list').innerText = "Fehler beim Datenabruf."; }
    }

    function saveAndRefresh() {
        localStorage.setItem('xinet_whitelist_storage', document.getElementById('whitelist-input').value);
        updateUI();
    }

    function renderStats() {
        document.getElementById('stat-total').innerText = fmt(masterStats.total_domains);
        let fc = 0, html = "";
        for (const [c, n] of Object.entries(masterStats.categories)) {
            fc += n; 
            // Hier werden die pulsierenden Icons generiert
            html += `
                <div class="flex justify-between items-center text-[11px]">
                    <span class="flex items-center gap-3">
                        <span class="relative flex h-2 w-2">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-success opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-2 w-2 bg-success"></span>
                        </span>
                        <span class="text-white/70 tracking-wider">${c.toUpperCase()}</span>
                    </span>
                    <span class="font-mono opacity-40">${fmt(n)}</span>
                </div>`;
        }
        document.getElementById('stat-filters').innerText = fmt(fc);
        document.getElementById('sources-list').innerHTML = html;
    }

    function updateUI() {
        const lim = document.getElementById('limit-range').value, sk = document.getElementById('target-system').value, conf = sys[sk];
        document.getElementById('limit-val').innerText = fmt(lim);
        const wl = document.getElementById('whitelist-input').value.split('\n').map(d => d.trim().toLowerCase()).filter(d => d);
        const cats = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(c => c.value);
        const filtered = exportData.filter(i => cats.includes(i.c) && !wl.includes(i.d.toLowerCase())).slice(0, lim);
        document.getElementById('stat-selected').innerText = fmt(filtered.length);
        const url = GITHUB_BASE + conf.f;
        document.getElementById('router-link').href = url; document.getElementById('router-link').innerText = url;
        let txt = "";
        filtered.slice(0, 15).forEach(i => {
            if (conf.raw) txt += JSON.stringify(i) + "\n";
            else txt += `${conf.p || ""}${i.d}${conf.s || ""}\n`;
        });
        document.getElementById('preview-area').innerText = txt || "Bereitschaft hergestellt.";
    }

    function downloadConfig() {
        const sk = document.getElementById('target-system').value, conf = sys[sk];
        const wl = document.getElementById('whitelist-input').value.split('\n').map(d => d.trim().toLowerCase()).filter(d => d);
        const cats = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(c => c.value);
        const filtered = exportData.filter(i => cats.includes(i.c) && !wl.includes(i.d.toLowerCase())).slice(0, document.getElementById('limit-range').value);
        let content = filtered.map(i => conf.raw ? JSON.stringify(i) : `${conf.p || ""}${i.d}${conf.s || ""}`).join("\n");
        const a = document.createElement('a'); a.href = window.URL.createObjectURL(new Blob([content])); a.download = conf.f; a.click();
    }
    document.getElementById('limit-range').addEventListener('input', updateUI);
    init();
</script>
</body>
</html>